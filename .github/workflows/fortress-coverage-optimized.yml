# ------------------------------------------------------------------------------------
#  GoFortress Coverage System (Optimized)
#
#  Purpose: Optimized coverage workflow using the github-actions command
#
#  Key Features:
#  - Binary caching for fast execution (80% faster setup)
#  - Security hardening with restrictive permissions
#  - Environment configuration from .env files
#  - Provider flexibility (internal/codecov)
#  - Complete coverage pipeline automation
#
#  Maintainer: @mrz1836
#
# ------------------------------------------------------------------------------------

name: GoFortress Coverage (Optimized)

on:
  workflow_call:
    inputs:
      coverage-file:
        description: "Path to coverage profile"
        required: true
        type: string
      branch-name:
        description: "Current branch name"
        required: true
        type: string
      commit-sha:
        description: "Commit SHA"
        required: true
        type: string
      env-json:
        description: "Environment configuration"
        required: true
        type: string
      primary-runner:
        description: "Primary runner OS"
        required: true
        type: string
      event-name:
        description: "GitHub event name (push, pull_request, etc)"
        required: false
        type: string
      pr-number:
        description: "Pull request number if applicable"
        required: false
        type: string
    secrets:
      github-token:
        description: "GitHub token for API access"
        required: true
      CODECOV_TOKEN:
        description: "Codecov token for uploading coverage (required when coverage-provider is codecov)"
        required: false

# Security: Restrictive default permissions with job-level overrides
permissions:
  contents: read

jobs:
  # ----------------------------------------------------------------------------------
  # Optimized Coverage Pipeline
  # ----------------------------------------------------------------------------------
  coverage:
    name: ğŸ“Š Coverage Pipeline (Optimized)
    runs-on: ${{ inputs.primary-runner }}
    timeout-minutes: 10
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    permissions:
      contents: write # Required for checkout and Pages deployment
      pages: write # Required for GitHub Pages deployment
      id-token: write # Required for GitHub Pages deployment
      pull-requests: write # Required for creating PR comments
      statuses: write # Required for commit status updates

    steps:
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # Environment Setup
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ”§ Parse environment configuration
        env:
          ENV_JSON: ${{ inputs.env-json }}
        run: |
          echo "ğŸ”§ Parsing environment configuration from input..."
          echo "$ENV_JSON" | jq -r 'to_entries | .[] | "\(.key)=\(.value)"' | while IFS='=' read -r key value; do
            echo "$key=$value" >> $GITHUB_ENV
          done
          echo "âœ… Environment configuration loaded"

      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
        with:
          fetch-depth: 0 # Required for version display and history

      - name: ğŸ“¥ Download coverage data artifact
        uses: actions/download-artifact@634f93cb2916e3fdff6788551b99b062d0335ce0 # v5.0.0
        with:
          name: coverage-data
          path: .

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # Go Setup with Caching
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ—ï¸ Setup Go with Cache
        uses: ./.github/actions/setup-go-with-cache
        with:
          go-version: ${{ env.GO_PRIMARY_VERSION }}
          matrix-os: ${{ inputs.primary-runner }}
          go-primary-version: ${{ env.GO_PRIMARY_VERSION }}
          go-secondary-version: ${{ env.GO_SECONDARY_VERSION }}

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # go-coverage Binary Caching
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ’¾ Cache go-coverage binary (production)
        id: go-coverage-cache
        if: env.GO_COVERAGE_USE_LOCAL != 'true'
        uses: actions/cache@0400d5f644dc74513175e3cd8d07132dd4860809 # v4.2.4
        with:
          path: ~/.cache/go-coverage-bin
          key: ${{ inputs.primary-runner }}-go-coverage-${{ env.GO_COVERAGE_VERSION }}

      - name: ğŸ’¾ Cache go-coverage binary (local development)
        id: go-coverage-local-cache
        if: env.GO_COVERAGE_USE_LOCAL == 'true'
        uses: actions/cache@0400d5f644dc74513175e3cd8d07132dd4860809 # v4.2.4
        with:
          path: ~/.cache/go-coverage-local
          key: ${{ inputs.primary-runner }}-local-go-coverage-${{ inputs.branch-name }}-${{ inputs.commit-sha }}
          restore-keys: |
            ${{ inputs.primary-runner }}-local-go-coverage-${{ inputs.branch-name }}-

      - name: ğŸ› ï¸ Setup cached go-coverage binary
        run: |
          set -euo pipefail

          # Setup for production version
          if [[ "${{ env.GO_COVERAGE_USE_LOCAL }}" != "true" ]]; then
            BIN_DIR="$HOME/.cache/go-coverage-bin"
            GO_COVERAGE_BIN="$BIN_DIR/go-coverage"
            if [[ -f "$GO_COVERAGE_BIN" ]]; then
              echo "âœ… Using cached go-coverage binary (production)"
              mkdir -p "$(go env GOPATH)/bin"
              cp "$GO_COVERAGE_BIN" "$(go env GOPATH)/bin/"
            fi
          else
            # Setup for local development version
            BIN_DIR="$HOME/.cache/go-coverage-local"
            GO_COVERAGE_BIN="$BIN_DIR/go-coverage"
            COMMIT_MARKER="$BIN_DIR/commit-sha"
            if [[ -f "$GO_COVERAGE_BIN" && -f "$COMMIT_MARKER" ]]; then
              CACHED_COMMIT=$(cat "$COMMIT_MARKER")
              if [[ "$CACHED_COMMIT" == "${{ inputs.commit-sha }}" ]]; then
                echo "âœ… Using cached go-coverage binary (local, commit: ${CACHED_COMMIT:0:8})"
                mkdir -p "$(go env GOPATH)/bin"
                cp "$GO_COVERAGE_BIN" "$(go env GOPATH)/bin/"
              else
                echo "âš ï¸ Cached binary is from different commit, will rebuild"
                rm -f "$GO_COVERAGE_BIN" "$COMMIT_MARKER"
              fi
            fi
          fi

          # Ensure binary location is on PATH
          echo "$(go env GOPATH)/bin" >> "$GITHUB_PATH"

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # go-coverage Installation (on cache miss or local development)
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ”¨ Install go-coverage
        if: steps.go-coverage-cache.outputs.cache-hit != 'true' || env.GO_COVERAGE_USE_LOCAL == 'true'
        run: |
          set -euo pipefail

          # Install go-coverage based on configuration
          if [[ "${{ env.GO_COVERAGE_USE_LOCAL }}" == "true" ]]; then
            echo "ğŸ”¨ Building local go-coverage from current repository..."
            go build -o "$(go env GOPATH)/bin/go-coverage" ./cmd/go-coverage

            # Cache the local build
            BIN_DIR="$HOME/.cache/go-coverage-local"
            mkdir -p "$BIN_DIR"
            cp "$(go env GOPATH)/bin/go-coverage" "$BIN_DIR/"
            echo "${{ inputs.commit-sha }}" > "$BIN_DIR/commit-sha"
            echo "âœ… Local go-coverage built and cached"
          else
            echo "ğŸ”¨ Installing go-coverage version ${{ env.GO_COVERAGE_VERSION }}..."
            go install github.com/mrz1836/go-coverage/cmd/go-coverage@${{ env.GO_COVERAGE_VERSION }}

            # Cache the production build
            BIN_DIR="$HOME/.cache/go-coverage-bin"
            mkdir -p "$BIN_DIR"
            cp "$(go env GOPATH)/bin/go-coverage" "$BIN_DIR/"
            echo "âœ… go-coverage ${{ env.GO_COVERAGE_VERSION }} installed and cached"
          fi

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # Coverage Execution - Single Command Replaces 2000+ Lines
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸš€ Execute Coverage Pipeline
        env:
          GITHUB_TOKEN: ${{ secrets.github-token }}
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
          # GitHub environment variables for proper branch detection
          GITHUB_HEAD_REF: ${{ inputs.branch-name }}
          GITHUB_REF_NAME: ${{ inputs.branch-name }}
          GITHUB_SHA: ${{ inputs.commit-sha }}
          GITHUB_PR_NUMBER: ${{ inputs.pr-number }}
        run: |
          echo "ğŸš€ Executing optimized coverage pipeline..."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“Š Coverage Configuration:"
          echo "  â€¢ Input file: ${{ inputs.coverage-file }}"
          echo "  â€¢ Provider: ${{ env.GO_COVERAGE_PROVIDER }}"
          echo "  â€¢ Branch: ${{ inputs.branch-name }}"
          echo "  â€¢ Commit: ${{ inputs.commit-sha }}"
          echo "  â€¢ Event: ${{ inputs.event-name }}"
          echo "  â€¢ PR: ${{ inputs.pr-number }}"
          echo ""

          # Execute the single github-actions command that replaces the entire workflow
          # For GitHub Pages deployment, we need to save files locally first
          go-coverage complete \
            --input="${{ inputs.coverage-file }}" \
            --output="./coverage-output" \
            --debug

          echo ""
          echo "âœ… Coverage pipeline completed successfully!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # Coverage Report Summary
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ“Š Coverage Report Summary
        if: always()
        run: |
          echo "ğŸ“Š Coverage Report Summary"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

          # Initialize variables
          COVERAGE_PCT="N/A"
          FILES_ANALYZED="N/A"
          PACKAGES="N/A"
          THRESHOLD="65.0"
          STATUS_ICON="â“"
          STATUS_TEXT="UNKNOWN"

          # Extract coverage metrics from various possible output files
          if [[ -f "coverage.json" ]]; then
            echo "ğŸ“„ Found coverage.json - extracting metrics..."
            COVERAGE_PCT=$(jq -r '.coverage_percentage // empty' coverage.json 2>/dev/null || echo "N/A")
            FILES_ANALYZED=$(jq -r '.files_analyzed // empty' coverage.json 2>/dev/null || echo "N/A")
            PACKAGES=$(jq -r '.packages // empty' coverage.json 2>/dev/null || echo "N/A")
            THRESHOLD=$(jq -r '.threshold // "65.0"' coverage.json 2>/dev/null || echo "65.0")
          fi

          # Try alternative coverage output files
          if [[ "$COVERAGE_PCT" == "N/A" ]] && ls coverage-stats-*.json 1> /dev/null 2>&1; then
            STATS_FILE=$(ls coverage-stats-*.json | head -1)
            echo "ğŸ“„ Found statistics file: $STATS_FILE"
            COVERAGE_PCT=$(jq -r '.coverage_percentage // empty' "$STATS_FILE" 2>/dev/null || echo "N/A")
            FILES_ANALYZED=$(jq -r '.files_processed // empty' "$STATS_FILE" 2>/dev/null || echo "N/A")
          fi

          # Try parsing from coverage reports if JSON not available
          if [[ "$COVERAGE_PCT" == "N/A" ]] && [[ -f "coverage.html" ]]; then
            echo "ğŸ“„ Extracting coverage from HTML report..."
            COVERAGE_PCT=$(grep -oP 'coverage:\s*\K[\d.]+' coverage.html 2>/dev/null | head -1 || echo "N/A")
          fi

          # Determine pass/fail status
          if [[ "$COVERAGE_PCT" != "N/A" ]] && [[ "$THRESHOLD" != "N/A" ]]; then
            if command -v bc >/dev/null 2>&1; then
              if (( $(echo "$COVERAGE_PCT >= $THRESHOLD" | bc -l 2>/dev/null) )); then
                STATUS_ICON="âœ…"
                STATUS_TEXT="PASSING"
              else
                STATUS_ICON="âŒ"
                STATUS_TEXT="FAILING"
              fi
            else
              # Fallback comparison without bc
              COVERAGE_INT=${COVERAGE_PCT%.*}
              THRESHOLD_INT=${THRESHOLD%.*}
              if [[ "$COVERAGE_INT" -ge "$THRESHOLD_INT" ]]; then
                STATUS_ICON="âœ…"
                STATUS_TEXT="PASSING"
              else
                STATUS_ICON="âŒ"
                STATUS_TEXT="FAILING"
              fi
            fi
          fi

          # Display coverage metrics
          echo ""
          echo "ğŸ“ˆ Coverage Metrics:"
          echo "  â€¢ Coverage: ${COVERAGE_PCT}%"
          echo "  â€¢ Threshold: ${THRESHOLD}%"
          echo "  â€¢ Status: ${STATUS_ICON} ${STATUS_TEXT}"
          echo "  â€¢ Files Analyzed: ${FILES_ANALYZED}"
          echo "  â€¢ Packages: ${PACKAGES}"

          # Display deployment URLs
          echo ""
          echo "ğŸŒ Coverage Reports:"
          BASE_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
          echo "  â€¢ Dashboard: ${BASE_URL}/"
          echo "  â€¢ Current Branch: ${BASE_URL}/coverage/branch/${{ inputs.branch-name }}/"
          if [[ -n "${{ inputs.pr-number }}" ]]; then
            echo "  â€¢ Pull Request: ${BASE_URL}/pr/${{ inputs.pr-number }}/"
          fi

          # Provider and workflow status
          echo ""
          echo "ğŸ”§ System Information:"
          echo "  â€¢ Provider: ${{ env.GO_COVERAGE_PROVIDER }}"
          echo "  â€¢ Event: ${{ inputs.event-name }}"
          echo "  â€¢ Runner: ${{ inputs.primary-runner }}"
          echo "  â€¢ Status: âœ… Pipeline completed successfully"

          # Create GitHub Actions job summary
          {
            echo "## ğŸ“Š Coverage Report Summary"
            echo ""
            echo "| Metric | Value |"
            echo "|--------|-------|"
            echo "| **Coverage** | ${COVERAGE_PCT}% |"
            echo "| **Threshold** | ${THRESHOLD}% |"
            echo "| **Status** | ${STATUS_ICON} ${STATUS_TEXT} |"
            echo "| **Files** | ${FILES_ANALYZED} |"
            echo "| **Provider** | ${{ env.GO_COVERAGE_PROVIDER }} |"
            echo "| **Branch** | ${{ inputs.branch-name }} |"
            echo ""
            echo "### ğŸŒ Coverage Reports"
            echo "- [ğŸ“Š Coverage Dashboard](${BASE_URL}/)"
            echo "- [ğŸŒ¿ Branch Coverage](${BASE_URL}/coverage/branch/${{ inputs.branch-name }}/)"
            if [[ -n "${{ inputs.pr-number }}" ]]; then
              echo "- [ğŸ”€ PR Coverage](${BASE_URL}/pr/${{ inputs.pr-number }}/)"
            fi
            echo ""
            echo "### ğŸ“ˆ Quick Stats"
            echo "- **Event**: ${{ inputs.event-name }}"
            echo "- **Commit**: ${{ inputs.commit-sha }}"
            echo "- **Workflow**: Optimized GoFortress Coverage"
          } >> $GITHUB_STEP_SUMMARY

          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ‰ Coverage pipeline completed successfully!"

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # GitHub Pages Deployment
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ“¦ Upload Pages artifact
        if: always()
        uses: actions/upload-pages-artifact@56afc609e74202658d3ffba0e8f6dda462b719fa # v3.0.1
        with:
          path: ./coverage-output

      - name: ğŸš€ Deploy to GitHub Pages
        if: always()
        id: deployment
        uses: actions/deploy-pages@d6db90164ac5ed86f2b6aed7e0febac5b3c0c03e # v4.0.5

      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      # Upload Coverage History Artifacts
      # â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
      - name: ğŸ“¤ Upload Coverage History Artifacts
        if: always()
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        continue-on-error: true
        with:
          name: coverage-history-${{ replace(inputs.branch-name, '/', '-') }}-${{ inputs.commit-sha }}-${{ github.run_number }}
          path: coverage-artifacts-staging/
          retention-days: 90
          if-no-files-found: ignore
